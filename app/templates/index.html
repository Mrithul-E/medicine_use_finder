<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Medicine Usage Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13/font/bootstrap-icons.min.css">
  <style>
    .highlight-box {
      background-color: #f8d7da;
      padding: 1rem;
      border-left: 6px solid #dc3545;
      border-radius: 0.5rem;
      font-size: 0.98rem;
      color: #842029;
    }

    #result h4,
    h5 {
      color: #0d6efd;
    }

    .list-style li::marker {
      color: #0d6efd;
    }

    footer a {
      text-decoration: none;
    }

    footer {
      background-color: #0d6efd;
    }

    html,body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
    }
  </style>
</head>

<body class="bg-light">

  <main>
    <div class="container mt-5 pt-4 pb-1 col-md-6 col-11 shadow rounded-4">
      <h3 class="text-center mb-4 text-primary"><b>Medicine Usage Finder</b></h3>

      <form id="medicineForm" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="medicine_name" class="form-label">Medicine Name</label>
          <input type="text" class="form-control" id="medicine_name" name="medicine_name"
            placeholder="e.g., Paracetamol">
        </div>

        <div class="mb-3">
          <label for="image" class="form-label">Upload Image</label>
          <input type="file" class="form-control" id="image" name="image" accept="image/*" capture="camera">
        </div>

        <button type="submit" class="btn btn-primary mb-2">Search</button>
      </form>

      <div id="result" class="d-none bg-light shadow rounded-4 mt-4 p-3 px-4">

      </div>
    </div>
  </main>

  <footer class="text-white py-2 mt-auto">
    <div class="container text-center">
      <div class="mb-2">Made with <i class="bi bi-heart-fill text-danger"></i> in India by <strong>Mrithul E</strong>
      </div>
      <div class="mb-2">
        <a href="https://github.com/Mrithul-E" target="_blank" rel="noopener noreferrer" class="text-white me-3">
          <i class="bi bi-github"></i> GitHub
        </a>
        <a href="https://www.instagram.com/mrithull_" target="_blank" rel="noopener noreferrer" class="text-white me-3">
          <i class="bi bi-instagram"></i> Instagram
        </a>
        <a href="mailto:mrithul100@gmail.com" class="text-white me-3">
          <i class="bi bi-envelope-at"></i> Email
        </a>
        <a href="https://stackoverflow.com/users/19938225/mrithul-e" target="_blank" rel="noopener noreferrer"
          class="text-white me-3">
          <i class="bi bi-stack-overflow"></i> Stack Overflow
        </a>
        <a href="https://www.threads.net/@mrithull_" target="_blank" rel="noopener noreferrer" class="text-white">
          <i class="bi bi-threads"></i> Threads
        </a>
      </div>


    </div>
  </footer>

  <script>
    $("#image").on('change', function () {
      if (this.files[0]) {
        $("#medicine_name").val("")
      }
    })

    $("#medicine_name").on('input', function () {
      $("#image").val("")
    })

    $('#medicineForm').on('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const result = $('#result');


      result.removeClass('d-none alert-info alert-danger').addClass('alert alert-info').text('Loading...');

      $.ajax({
        url: '/api/find-usage',
        method: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function (response) {
          // response = JSON.parse(response)


          result.removeClass('d-none alert-info');
          if (response.error) {
            result.addClass('alert alert-danger').text(response.error);
          } else {
            result.html(`
          <h4 class="text-center mt-2 mb-4"><b>ü©∫ Medicine Overview</b></h4>

          <div class="mb-4">
            <h5>üíä Name</h5>
            <p>${response.medicine_name}</p>
          </div>

          <div class="mb-4">
            <h5>üß™ Generic Name</h5>
            <p>${response.generic_name}</p>
          </div>

          <div class="mb-4">
            <h5>üìÇ Drug Type</h5>
            <p>${response.drug_class}</p>
          </div>

          <div class="mb-4 shadow rounded-3 p-2" style="box-shadow: 0 0 10px #0d6efd !important;">
            <h5>üìå What it‚Äôs used for</h5>
            <p>${response.use}</p>
          </div>

          <div class="mb-4">
            <h5>üîç How it works</h5>
            <p>${response.how_it_works}</p>
          </div>

          <div class="mb-4">
            <h5>üìÖ When to take</h5>
            <p>${response.when_to_take}</p>
          </div>

          <div class="mb-4">
            <h5>‚ö†Ô∏è Important to know</h5>
            <div class="highlight-box" id="important">${response.important_to_know}</div>
          </div>

          <div class="mb-4">
            <h5>üí• Common Side Effects</h5>
            <ul class="list-style">
              ${response.common_side_effects.map(effect => `<li>${effect}</li>`).join("")}
            </ul>
          </div>

          <div class="mb-4">
            <h5>üè∑Ô∏è Other Brand Names</h5>
            <ul class="list-style">
              ${response.brand_names.map(name => `<li>${name}</li>`).join("")}
            </ul>
          </div>

          <div class="alert alert-secondary mt-4 text-center small">
            ‚ö†Ô∏è This information is for general understanding only and is not medical advice. Always consult a doctor or pharmacist before using any medicine.
          </div>
          `)
          }
        },
        error: function () {
          result.removeClass('d-none').addClass('alert-danger').text('Something went wrong.');
        }
      });
    });
  </script>

</body>

</html>