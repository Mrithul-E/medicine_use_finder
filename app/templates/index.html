<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Medicine Usage Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    .highlight-box {
      background-color: #f8d7da;
      padding: 1rem;
      border-left: 6px solid #dc3545;
      border-radius: 0.5rem;
      font-size: 0.98rem;
      color: #842029;
    }

    #result h4, h5 {
      color: #0d6efd;
    }

    .list-style li::marker {
      color: #0d6efd;
    }
  </style>
</head>
<body class="bg-light">

<div class="container mt-5 pt-4 pb-1 col-md-6 col-11 shadow rounded-4">
  <h3 class="text-center mb-4">Medicine Usage Finder</h3>

  <form id="medicineForm" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="medicine_name" class="form-label">Medicine Name</label>
      <input type="text" class="form-control" id="medicine_name" name="medicine_name" placeholder="e.g., Paracetamol">
    </div>

    <div class="mb-3">
      <label for="image" class="form-label">Upload Image</label>
      <input type="file" class="form-control" id="image" name="image" accept="image/*" capture="camera">
    </div>

    <button type="submit" class="btn btn-primary">Search</button>
  </form>

  <div id="result" class="d-none bg-light shadow rounded-4 mt-4 p-3 px-4">
    
  </div>
</div>

<script>
  $("#image").on('change', function () {
    if (this.files[0]) {
      $("#medicine_name").val("")
    }
  })

  $("#medicine_name").on('input', function () {
    $("#image").val("")
  })

  $('#medicineForm').on('submit', function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const result = $('#result');


    result.removeClass('d-none alert-info alert-danger').addClass('alert alert-info').text('Loading...');

    $.ajax({
      url: '/api/find-usage',
      method: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      success: function (response) {
        // response = JSON.parse(response)
        
        
        result.removeClass('d-none alert-info');
        if (response.error) {
          result.addClass('alert alert-danger').text(response.error);
        } else {
          result.html(`
          <h4 class="text-center mt-2 mb-4"><b>ğŸ©º Medicine Overview</b></h4>

          <div class="mb-4">
            <h5>ğŸ’Š Name</h5>
            <p>${response.medicine_name}</p>
          </div>

          <div class="mb-4">
            <h5>ğŸ§ª Generic Name</h5>
            <p>${response.generic_name}</p>
          </div>

          <div class="mb-4">
            <h5>ğŸ“‚ Drug Type</h5>
            <p>${response.drug_class}</p>
          </div>

          <div class="mb-4 shadow rounded-3 p-2" style="box-shadow: 0 0 10px #0d6efd !important;">
            <h5>ğŸ“Œ What itâ€™s used for</h5>
            <p>${response.use}</p>
          </div>

          <div class="mb-4">
            <h5>ğŸ” How it works</h5>
            <p>${response.how_it_works}</p>
          </div>

          <div class="mb-4">
            <h5>ğŸ“… When to take</h5>
            <p>${response.when_to_take}</p>
          </div>

          <div class="mb-4">
            <h5>âš ï¸ Important to know</h5>
            <div class="highlight-box" id="important">${response.important_to_know}</div>
          </div>

          <div class="mb-4">
            <h5>ğŸ’¥ Common Side Effects</h5>
            <ul class="list-style">
              ${response.common_side_effects.map(effect => `<li>${effect}</li>`).join("")}
            </ul>
          </div>

          <div class="mb-4">
            <h5>ğŸ·ï¸ Other Brand Names</h5>
            <ul class="list-style">
              ${response.brand_names.map(name => `<li>${name}</li>`).join("")}
            </ul>
          </div>

          <div class="alert alert-secondary mt-4 text-center small">
            âš ï¸ This information is for general understanding only and is not medical advice. Always consult a doctor or pharmacist before using any medicine.
          </div>
          `)
        }
      },
      error: function () {
        result.removeClass('d-none').addClass('alert-danger').text('Something went wrong.');
      }
    });
  });
</script>

</body>
</html>
